(function(c){var k=0;c.widget("ui.prettypiemenu",{options:{buttons:{},closeRadius:20,closePadding:3,outerPadding:10,globalAlpha:1,onSelection:function(){},className:"ui-ppmenu-pieBg",centerIconInActive:"../images/45_red.gif",centerIconActive:"../images/45_green.gif",backgroundColor:"transparent",iconW:16,iconH:16,centerIconW:30,centerIconH:30,showAnimationSpeed:300,showStartAnimation:true,showTitles:false},_create:function(){var b=this,a=b.options,d=b.idPrefix="piemenu_"+ ++k+"_img_";b.highlight= "x";var f=b.nSegments=c(a.buttons).length,g=b.radius=b._minRadius(a)+a.closeRadius+a.closePadding;b.showStartAnimation=a.showStartAnimation;var h=b.pieArea=c(document.createElement("div")).appendTo(document.body).hide().addClass(a.className).css({width:g*2,height:g*2,position:"absolute"}).bind("contextmenu",function(e){e.preventDefault();return false});b.tooltip=c(document.createElement("div")).hide().addClass("ui-widget ui-widget-content ui-ppmenu-tooltip").appendTo(c(h)).css({top:a.closeRadius- a.iconH/2,left:a.closeRadius-a.iconW/2});b.ballIcon=c(document.createElement("span")).hide().addClass("ui-icon ui-icon-radio-off").appendTo(c(h)).css({top:a.closeRadius-a.iconH/2,left:a.closeRadius-a.iconW/2,position:"absolute"});b.centerIcon=c(document.createElement("img")).attr("src",a.centerIconInActive).appendTo(c(h)).css({top:g-a.centerIconH/2,left:g-a.centerIconW/2,position:"absolute",border:0});c(a.buttons).each(function(e,i){var j=b._iconPos(g,e,f,a.outerPadding,a,50,2);j=c(document.createElement("div")).appendTo(c(h)).addClass("ui-ppmenu-iconBg ui-state-hover").css({top:j.top, left:j.left,width:a.iconW,height:a.iconH});c(document.createElement("span")).attr({id:d+e}).appendTo(c(j)).addClass("ui-icon "+i.img)});c(b.element).mousedown(function(e){e.preventDefault();if(e.which==3)if(e.pageX-g<0)b.show({left:e.pageX-(e.pageX-g),top:e.pageY});else e.pageX+g>c(window).width()?b.show({left:e.pageX-(e.pageX+g-c(window).width()),top:e.pageY}):b.show({left:e.pageX,top:e.pageY});return false})},_init:function(){var b=this.options;this.highlight="x";this.nSegments=c(b.buttons).length; this.radius=this._minRadius(b)+b.closeRadius+b.closePadding;this.showStartAnimation=b.showStartAnimation},hide:function(){var b=this;c(b.options.buttons).each(function(a){var d=b._iconPos(b.radius,a,b.nSegments,b.options.outerPadding,b.options,50,2);c("#"+b.idPrefix+a).parent().animate({top:d.top,left:d.left},500);c("#"+b.idPrefix+a).parent().switchClass("ui-state-active","ui-state-hover",0)});b.pieArea.fadeOut(400,function(){c(document.body).unbind("contextmenu");return false});b.ballIcon.hide(); b.tooltip.hide();b.centerIcon.attr("src",b.options.centerIconInActive);return b},_unbindEvents:function(){this.pieArea.unbind("mousemove").unbind("mouseup");c(document.body).unbind("mouseup.ppmenu");c(document.body).unbind("mousemove.ppmenu")},destroy:function(){this._unbindEvents();this.hide();return self},widget:function(){return this.pieArea},_innerSegmentAngle:function(b){return this._paddedSegmentAngle(b)-Math.PI/180*4},_paddedSegmentAngle:function(b){return 2*Math.PI/b},_startAngle:function(b, a){return-Math.PI/2+this._paddedSegmentAngle(a)*b},_endAngle:function(b,a){return this._startAngle(b,a)+this._innerSegmentAngle(a)},_iconPos:function(b,a,d,f,g,h,e){g=this._startAngle(a,d);var i=this._endAngle(a,d);a=this.options.iconW;d=this.options.iconH;f=b-Math.max(a,d)/2-f+h;e=g+(i-g)/2+e;return{top:b+Math.sin(e)*f-d/2,left:b+Math.cos(e)*f-a/2}},_minRadius:function(b){var a=0,d=0;c(b.buttons).each(function(){var h=b.iconW,e=b.iconH;a=Math.max(a,Math.sqrt(h*h+e*e));d=Math.max(d,h,e)});var f=this._paddedSegmentAngle(c(b.buttons).length), g=a/2;return Math.ceil(g*Math.sin((Math.PI-f)/2)+Math.max(g,d)+b.outerPadding)},show:function(b){var a=this;a.highlight="x";a.pieArea.css({top:b.top-a.radius,left:b.left-a.radius});c(document.body).bind("contextmenu",function(d){d.preventDefault();return false},false);c(document.body).bind("mouseup.ppmenu",function(d){d.preventDefault();a.destroy(d);return false},false);c(document.body).bind("mousemove.ppmenu",function(d){d.preventDefault();a._changeHighlight(d);return false},false);a.pieArea.mousemove(function(d){a._changeHighlight(d)}, false).bind("mouseup",a.options,function(d){a._onClick(d)},false);a.pieArea.fadeIn(a.options.showAnimationSpeed);a.showStartAnimation=a.options.showStartAnimation;c(a.options.buttons).each(function(d){var f=a._iconPos(a.radius,d,a.nSegments,a.options.outerPadding,a.options,50,2);c("#"+a.idPrefix+d).parent().css({top:f.top,left:f.left})});a._draw()},_draw:function(){var b=this;c(b.options.buttons).each(function(a,d){var f=c("#"+b.idPrefix+a);if(b.showStartAnimation){var g=b._iconPos(b.radius,a,b.nSegments, b.options.outerPadding,b.options,0,0);c(f).parent().animate({top:g.top,left:g.left},b.options.showAnimationSpeed,function(){b.highlight="x"})}if(a===b.highlight){c(f).parent().switchClass("ui-state-hover","ui-state-active",0);if(b.options.showTitles){f=b._iconPos(b.radius,a,b.nSegments,b.options.outerPadding,b.options,0,0);b.tooltip.html(d.title);var h={top:f.top,left:f.left-b.tooltip.width()-b.options.iconW*2},e={top:f.top,left:f.left+b.options.iconW*2};f=f.left<b.radius?h:e;b.tooltip.animate({top:f.top, left:f.left},300,function(){if(b.tooltip.offset().left<0)b.tooltip.css({top:e.top,left:e.left});else b.tooltip.offset().left+b.tooltip.width()>c(window).width()&&b.tooltip.css({top:h.top,left:h.left})})}}else c(f).parent().switchClass("ui-state-active","ui-state-hover",0)});b.showStartAnimation=false},_onClick:function(b){this._unbindEvents();this.highlight>=0&&this.highlight<this.nSegments&&b.data.onSelection&&b.data.onSelection(this.highlight,this.element);this.hide()},_changeHighlight:function(b){var a= this,d=a.highlight,f=a.pieArea.offset(),g=b.pageX-f.left,h=b.pageY-f.top;b=a.pieArea.width()/2;var e=a.pieArea.height()/2;f=Math.sqrt((b-g)*(b-g)+(e-h)*(e-h));if(f<a.options.closeRadius){a.highlight="x";if(a.highlight!=d){a._draw();a.centerIcon.attr("src",a.options.centerIconInActive);a.ballIcon.hide();a.tooltip.fadeOut()}}else if(f>a.options.closeRadius+a.options.closePadding){h=h-e;var i=null;i=g-b<0?Math.PI+Math.asin(-h/f):Math.asin(h/f);c(a.options.buttons).each(function(j){if(a._startAngle(j, a.nSegments)<i&&a._endAngle(j,a.nSegments)>=i){a.highlight=j;return false}return true});a.highlight!=d&&a._draw();if(f>a.radius+a.options.outerPadding){if(a.centerIcon.attr("src")!=a.options.centerIconInActive){a.centerIcon.attr("src",a.options.centerIconInActive);a.tooltip.fadeOut()}}else if(a.centerIcon.attr("src")!=a.options.centerIconActive){a.centerIcon.attr("src",a.options.centerIconActive);a.ballIcon.show();a.options.showTitles&&a.tooltip.fadeIn()}a.ballIcon.css({top:a.radius+Math.sin(i)*a.options.closeRadius- a.options.iconH/2,left:a.radius+Math.cos(i)*a.options.closeRadius-a.options.iconW/2})}return false}});c.extend(c.ui.prettypiemenu,{version:"1.8.8"})})(jQuery);